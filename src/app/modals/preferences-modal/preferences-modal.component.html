<div class="preferences-modal">
  <!-- ðŸ”¹ Modal Header -->
  <div class="modal-header" data-tauri-drag-region>
    <button><img src="assets/icons/titlebar/search.svg" class="icon icon-bw" /></button>
    <div class="tabs">
      <button *ngFor="let tab of tabs; let i = index" (click)="selectTab(i)" [class.active]="selectedTabIndex === i">
        <img src="assets/icons/{{tab.icon}}" class="icon icon-bw" />{{ tab.label }}
      </button>
    </div>
    <button (click)="close()"><img src="assets/icons/circle-xmark.svg" class="icon icon-bw" /></button>
  </div>

  <!-- ðŸ”¹ Modal Content -->
  <div class="modal-content">
    <ng-container *ngFor="let category of getObjectKeys(settings)">
      <ng-container *ngIf="selectedTab === category">
        <div class="tab-content">
          <div class="settings-list">
            <div class="setting-item" *ngFor="let key of getObjectKeys(settings[category])">
              <!-- âœ… Fetch metadata -->
              <ng-container *ngIf="getMetadata(category, key) as meta">
                <div class="setting-info">
                  <strong>{{ meta.display_name }}</strong>
                  <p>{{ meta.help_text }}</p>
                </div>

                <div class="setting-control">
                  <!-- âœ… Boolean Settings (Toggle) -->
                  <mat-slide-toggle *ngIf="meta.value_type === 'bool'" [(ngModel)]="settings[category][key]"
                    (change)="updateSetting(category, key, settings[category][key])">
                  </mat-slide-toggle>

                  <!-- âœ… Number Settings -->
                    <mat-form-field class="input-field" appearance="outline"
                    *ngIf="meta.value_type === 'number'">
                    <input matInput type="number" min="1" [(ngModel)]="settings[category][key]"
                      (input)="updateSetting(category, key, settings[category][key])" />
                    </mat-form-field>

                  <!-- âœ… String Settings -->
                  <mat-form-field class="input-field" appearance="outline" *ngIf="meta.value_type === 'string'">
                    <!-- Special Case for Default Mount Type -->
                    <mat-select *ngIf="key === 'default_mount_type'" [(ngModel)]="settings[category][key]"
                      (selectionChange)="updateSetting(category, key, settings[category][key])">
                      <mat-option value="native">Native</mat-option>
                      <mat-option value="systemd">Systemd</mat-option>
                    </mat-select>

                    <input *ngIf="key !== 'default_mount_type'" matInput [(ngModel)]="settings[category][key]"
                      (input)="updateSetting(category, key, settings[category][key])" />
                  </mat-form-field>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </div>
</div>