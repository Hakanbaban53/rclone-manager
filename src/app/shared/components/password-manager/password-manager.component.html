<div class="password-section" [class.entering]="isEntering">
  <!-- Error message with enhanced styling -->
  @if (hasError) {
    <div class="password-description error">
      {{ errorMessage }}
    </div>
  }

  <div class="password-form">
    <!-- Enhanced password input field -->
    <div class="password-field-container">
      <mat-form-field appearance="outline" class="password-field">
        <mat-label>Configuration Password</mat-label>
        <input
          matInput
          type="password"
          [value]="password"
          (input)="onPasswordInput($any($event.target).value)"
          [disabled]="isSubmitting || disabled || (lockoutStatus?.is_locked ?? false)"
          placeholder="Enter your rclone config password"
          autocomplete="current-password"
          #passwordInput
        />
        <mat-icon
          matSuffix
          svgIcon="key"
          [matTooltip]="isSubmitting ? 'Verifying password...' : 'Configuration password required'"
        >
        </mat-icon>
      </mat-form-field>
    </div>

    <!-- Enhanced store password option -->
    @if (showStoreOption) {
      <div class="store-option">
        <mat-checkbox
          [checked]="storePassword"
          (change)="onStoreChange($event.checked)"
          [disabled]="isSubmitting || disabled"
          color="primary"
        ></mat-checkbox>
        <div class="store-option-content">
          <p class="store-label">Remember password securely</p>
          <div class="store-info">
            <mat-icon class="info-icon" svgIcon="shield"></mat-icon>
            <span
              >Password will be stored using your system's secure credential store
              (Keychain/Credential Manager)</span
            >
          </div>
        </div>
      </div>
    }

    <!-- Enhanced lockout status display -->
    @if (lockoutStatus && (lockoutStatus.failed_attempts > 0 || lockoutStatus.is_locked)) {
      <div class="lockout" [attr.aria-live]="'polite'">
        @if (lockoutStatus.is_locked) {
          <mat-icon
            class="lockout-icon locked"
            svgIcon="lock"
            matTooltip="Account is temporarily locked"
          >
          </mat-icon>
        }
        @if (!lockoutStatus.is_locked && lockoutStatus.failed_attempts > 0) {
          <mat-icon
            class="lockout-icon warning"
            svgIcon="warning"
            matTooltip="Multiple failed attempts detected"
          >
          </mat-icon>
        }
        <div class="lockout-details">
          <div class="lockout-text">
            <!-- Not locked state -->
            @if (!lockoutStatus.is_locked) {
              <div class="primary-text">
                <span class="attempts"
                  >{{ lockoutStatus.failed_attempts }}/{{ lockoutStatus.max_attempts }}</span
                >
                failed attempts
              </div>
              <div class="secondary-text">
                {{ getAttemptsRemainingText(lockoutStatus) }}
              </div>
            }
            <!-- Locked state -->
            @if (lockoutStatus.is_locked) {
              <div class="primary-text">
                <span class="error-text">Account Locked</span>
              </div>
              <div class="secondary-text">
                Unlocks in
                <strong>{{
                  FormatTimePipe.transform(lockoutStatus.remaining_lockout_time || 0)
                }}</strong>
              </div>
            }
          </div>
        </div>
        <!-- Progress bar for lockout time -->
        @if (lockoutStatus.is_locked && lockoutStatus.remaining_lockout_time) {
          <div class="lockout-progress">
            <div
              class="progress-bar"
              [style.animation-duration]="lockoutStatus.remaining_lockout_time + 's'"
            ></div>
          </div>
        }
      </div>
    }
  </div>
</div>
