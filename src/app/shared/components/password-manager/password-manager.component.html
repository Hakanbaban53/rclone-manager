<div class="password-section">
  <div class="password-header">
    <mat-icon class="header-icon" svgIcon="lock"></mat-icon>
    <h4>Configuration Password Required</h4>
  </div>

  <p class="password-description" *ngIf="!hasError">
    Please enter your configuration password to unlock encrypted remotes.
  </p>
  <p class="password-description error" *ngIf="hasError">{{ errorMessage }}</p>

  <div class="password-form">
    <mat-form-field appearance="outline" class="password-field">
      <mat-label>Configuration Password</mat-label>
      <input
        matInput
        type="password"
        [value]="password"
        (input)="onPasswordInput($any($event.target).value)"
        [disabled]="isSubmitting || disabled || (lockoutStatus?.is_locked ?? false)"
        placeholder="Enter your rclone config password"
        autocomplete="current-password"
      />
      <mat-icon matSuffix svgIcon="key"></mat-icon>
    </mat-form-field>

    <div class="store-option" *ngIf="showStoreOption">
      <mat-checkbox
        [checked]="storePassword"
        (change)="onStoreChange($event.checked)"
        [disabled]="isSubmitting || disabled"
      >
        Remember password securely in system keyring
      </mat-checkbox>
      <div class="store-info">
        <mat-icon class="info-icon" svgIcon="circle-info"></mat-icon>
        <span>Password will be stored using your system's secure credential store</span>
      </div>
    </div>

    <div class="lockout" *ngIf="lockoutStatus?.is_locked">
      <mat-icon svgIcon="block"></mat-icon>
      <span>
        Too many failed attempts. Please wait
        <strong>{{ formatTime(lockoutStatus?.remaining_lockout_time || 0) }}</strong>
      </span>
    </div>

    <div class="actions">
      <button
        mat-stroked-button
        (click)="onPasswordInput('')"
        [disabled]="isSubmitting || disabled"
      >
        Clear
      </button>
      <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="!canSubmit()">
        <mat-progress-spinner
          *ngIf="isSubmitting"
          diameter="18"
          mode="indeterminate"
        ></mat-progress-spinner>
        <span *ngIf="!isSubmitting">Unlock</span>
      </button>
    </div>
  </div>
</div>
